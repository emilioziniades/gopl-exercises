<!DOCTYPE html><html lang="en"><head>

<link rel="preconnect" href="https://www.googletagmanager.com"/>
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-W8MVQXG');</script>
  
<meta charset="utf-8"/>
<meta name="description" content="Go is an open source programming language that makes it easy to build simple, reliable, and efficient software."/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<meta name="theme-color" content="#00add8"/>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Google+Sans:400,500,600|Work+Sans:400,500,600|Roboto:400,500,700|Open+Sans:Source+Code+Pro|Material+Icons"/>
<link rel="stylesheet" href="/css/styles.css"/>

  
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-W8MVQXG');</script>
  
<script src="/js/site.js"></script>
<title>Managing connections - The Go Programming Language</title>
</head>
<body class="Site">
  
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-W8MVQXG"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  


<header class="Site-header js-siteHeader">
  <div class="Header Header--dark">
    <nav class="Header-nav">
      <a href=".///index.html">
        <img class="js-headerLogo Header-logo" src="/images/go-logo-white.svg" alt="Go"/>
      </a>
      <div class="Header-rightContent">
        <ul class="Header-menu">
          <li class="Header-menuItem ">
            <a href=".//solutions//index.html">Why Go</a>
          </li>
          <li class="Header-menuItem ">
            <a href=".//learn//index.html">Get Started</a>
          </li>
          <li class="Header-menuItem  Header-menuItem--active">
            <a href=".//doc//index.html">Docs</a>
          </li>
          <li class="Header-menuItem ">
            <a href=".//index.html">Packages</a>
          </li>
          <li class="Header-menuItem ">
            <a href=".//play//index.html">Play</a>
          </li>
          <li class="Header-menuItem ">
            <a href=".//blog//index.html">Blog</a>
          </li>
        </ul>
        <button class="Header-navOpen js-headerMenuButton Header-navOpen--white" aria-label="Open navigation.">
        </button>
      </div>
    </nav>
    
  </div>
</header>
<aside class="NavigationDrawer js-header">
  <nav class="NavigationDrawer-nav">
    <div class="NavigationDrawer-header">
      <a href=".///index.html">
        <img class="NavigationDrawer-logo" src="/images/go-logo-blue.svg" alt="Go."/>
      </a>
    </div>
    <ul class="NavigationDrawer-list">
        <li class="NavigationDrawer-listItem ">
          <a href=".//solutions//index.html">Why Go</a>
        </li>
        <li class="NavigationDrawer-listItem ">
          <a href=".//learn//index.html">Get Started</a>
        </li>
        <li class="NavigationDrawer-listItem  NavigationDrawer-listItem--active">
          <a href=".//doc//index.html">Docs</a>
        </li>
        <li class="NavigationDrawer-listItem ">
          <a href=".//index.html">Packages</a>
        </li>
        <li class="NavigationDrawer-listItem ">
          <a href=".//play//index.html">Play</a>
        </li>
        <li class="NavigationDrawer-listItem ">
          <a href=".//blog//index.html">Blog</a>
        </li>
    </ul>
  </nav>
</aside>
<div class="NavigationDrawer-scrim js-scrim" role="presentation"></div>
<main class="SiteContent SiteContent--default">
  


<article class="Doc Article">


<h1>Managing connections</h1>






<div id="nav" class="TOC"></div>


<p>For the vast majority of programs, you needn’t adjust the <code>sql.DB</code> connection
pool defaults. But for some advanced programs, you might need to tune the
connection pool parameters or work with connections explicitly. This topic
explains how.</p>
<p>The <a href=".//database/sql/index.html" rel="noreferrer" target="_blank"><code>sql.DB</code></a> database handle is safe for
concurrent use by multiple goroutines
(meaning the handle is what other languages might call “thread-safe”). Some
other database access libraries are based on connections that can only be used
for one operation at a time. To bridge that gap, each <code>sql.DB</code> manages a pool
of active connections to the underlying database, creating new ones as needed
for parallelism in your Go program.</p>
<p>The connection pool is suitable for most data access needs. When you call an
<code>sql.DB</code> <code>Query</code> or <code>Exec</code> method, the <code>sql.DB</code> implementation retrieves an
available connection from the pool or, if needed, creates one. The package
returns the connection to the pool when it’s no longer needed. This supports a
high level of parallelism for database access.</p>
<h3 id="connection_pool_properties">Setting connection pool properties</h3>
<p>You can set properties that guide how the <code>sql</code> package manages a connection
pool. To get statistics about the effects of these properties, use
<a href=".//database/sql/index.html" rel="noreferrer" target="_blank"><code>DB.Stats</code></a>.</p>
<h4 id="max_open_connections">Setting the maximum number of open connections</h4>
<p><a href=".//database/sql/index.html" rel="noreferrer" target="_blank"><code>DB.SetMaxOpenConns</code></a>
imposes a limit on the number of open connections. Past this limit, new
database operations will wait for an existing operation to finish, at which
time <code>sql.DB</code> will create another connection. By default, <code>sql.DB</code> creates a
new connection any time all the existing connections are in use when a
connection is needed.</p>
<p>Keep in mind that setting a limit makes database usage similar to acquiring a
lock or semaphore, with the result that your application can deadlock waiting
for a new database connection.</p>
<h4 id="max_idle_connections">Setting the maximum number of idle connections</h4>
<p><a href=".//database/sql/index.html" rel="noreferrer" target="_blank"><code>DB.SetMaxIdleConns</code></a>
changes the limit on the maximum number of idle connections <code>sql.DB</code>
maintains.</p>
<p>When an SQL operation finishes on a given database connection, it is not
typically shut down immediately: the application may need one again soon, and
keeping the open connection around avoids having to reconnect to the database
for the next operation. By default an <code>sql.DB</code> keeps two idle connections at
any given moment. Raising the limit can avoid frequent reconnects in programs
with significant parallelism.</p>
<h4 id="max_idle_time">Setting the maximum amount a time a connection can be idle</h4>
<p><a href=".//database/sql/index.html" rel="noreferrer" target="_blank"><code>DB.SetConnMaxIdleTime</code></a>
sets the maximum length of time a connection can be idle before it is closed.
This causes the <code>sql.DB</code> to close connections that have been idle for longer
than the given duration.</p>
<p>By default, when an idle connection is added to the connection pool, it
remains there until it is needed again. When using <code>DB.SetMaxIdleConns</code> to
increase the number of allowed idle connections during bursts of parallel
activity, also using <code>DB.SetConnMaxIdleTime</code> can arrange to release those
connections later when the system is quiet.</p>
<h4 id="max_connection_lifetime">Setting the maximum lifetime of connections</h4>
<p>Using <a href=".//database/sql/index.html" rel="noreferrer" target="_blank"><code>DB.SetConnMaxLifetime</code></a>
sets the maximum length of time a connection can be held open before it is
closed.</p>
<p>By default, a connection can be used and reused for an arbitrarily long amount
of time, subject to the limits described above. In some systems, such as those
using a load-balanced database server, it can be helpful to ensure that the
application never uses a particular connection for too long without reconnecting.</p>
<h3 id="dedicated_connections">Using dedicated connections</h3>
<p>The <code>database/sql</code> package includes functions you can use when a database may
assign implicit meaning to a sequence of operations executed on a particular
connection.</p>
<p>The most common example is transactions, which typically start with a <code>BEGIN</code>
command, end with a <code>COMMIT</code> or <code>ROLLBACK</code> command, and include all the
commands issued on the connection between those commands in the overall
transaction. For this use case, use the <code>sql</code> package’s transaction support.
See <a href=".//doc/database/execute-transactions/index.html">Executing transactions</a>.</p>
<p>For other use cases where a sequence of individual operations must all execute
on the same connection, the <code>sql</code> package provides dedicated connections.
<a href=".//database/sql/index.html" rel="noreferrer" target="_blank"><code>DB.Conn</code></a> obtains a dedicated
connection, an <a href=".//database/sql/index.html" rel="noreferrer" target="_blank"><code>sql.Conn</code></a>. The
<code>sql.Conn</code> has methods <code>BeginTx</code>, <code>ExecContext</code>, <code>PingContext</code>,
<code>PrepareContext</code>, <code>QueryContext</code>, and <code>QueryRowContext</code> that behave like the
equivalent methods on DB but only use the dedicated connection. When finished
with the dedicated connection, your code must release it using <code>Conn.Close</code>.</p>


</article>



</main>
<footer class="Site-footer">
  <div class="Footer">
    <div class="Container">
      <div class="Footer-links">
          <div class="Footer-linkColumn">
            <a href=".//solutions//index.html" class="Footer-link Footer-link--primary">
              Why Go
            </a>
              <a href=".//solutions//index.html" class="Footer-link">
                Use Cases
              </a>
              <a href=".//solutions//index.html" class="Footer-link">
                Case Studies
              </a>
          </div>
          <div class="Footer-linkColumn">
            <a href=".//learn//index.html" class="Footer-link Footer-link--primary">
              Get Started
            </a>
              <a href=".//play/index.html" class="Footer-link">
                Playground
              </a>
              <a href=".//tour//index.html" class="Footer-link">
                Tour
              </a>
              <a href=".//questions/tagged/go/index.html" class="Footer-link">
                Stack Overflow
              </a>
              <a href=".//help//index.html" class="Footer-link">
                Help
              </a>
          </div>
          <div class="Footer-linkColumn">
            <a href=".//index.html" class="Footer-link Footer-link--primary">
              Packages
            </a>
              <a href=".//pkg//index.html" class="Footer-link">
                Standard Library
              </a>
          </div>
          <div class="Footer-linkColumn">
            <a href=".//project/index.html" class="Footer-link Footer-link--primary">
              About
            </a>
              <a href=".//dl//index.html" class="Footer-link">
                Download
              </a>
              <a href=".//blog//index.html" class="Footer-link">
                Blog
              </a>
              <a href=".//golang/go/issues/index.html" class="Footer-link">
                Issue Tracker
              </a>
              <a href=".//doc/devel/release/index.html" class="Footer-link">
                Release Notes
              </a>
              <a href=".//go-brand/index.html" class="Footer-link">
                Brand Guidelines
              </a>
              <a href=".//conduct/index.html" class="Footer-link">
                Code of Conduct
              </a>
          </div>
          <div class="Footer-linkColumn">
            <a href=".//golang/index.html" class="Footer-link Footer-link--primary">
              Connect
            </a>
              <a href=".//golang/index.html" class="Footer-link">
                Twitter
              </a>
              <a href=".//golang/index.html" class="Footer-link">
                GitHub
              </a>
              <a href=".///index.html" class="Footer-link">
                Slack
              </a>
              <a href=".//r/golang/index.html" class="Footer-link">
                r/golang
              </a>
              <a href=".//pro/go/index.html" class="Footer-link">
                Meetup
              </a>
              <a href=".///index.html" class="Footer-link">
                Golang Weekly
              </a>
          </div>
      </div>
    </div>
  </div>
  <div class="Footer">
    <div class="Container Container--fullBleed">
      <div class="Footer-bottom">
        <img class="Footer-gopher" src="/images/gophers/pilot-bust.svg" alt="The Go Gopher"/>
        <ul class="Footer-listRow">
          <li class="Footer-listItem">
            <a href=".//copyright/index.html">Copyright</a>
          </li>
          <li class="Footer-listItem">
            <a href=".//tos/index.html">Terms of Service</a>
          </li>
          <li class="Footer-listItem">
            <a href=".//intl/en/policies/privacy//index.html" target="_blank" rel="noopener">
              Privacy Policy
            </a>
            </li>
          <li class="Footer-listItem">
            <a href=".//s/website-issue/index.html" target="_blank" rel="noopener">
              Report an Issue
            </a>
          </li>
        </ul>
        <a class="Footer-googleLogo" target="_blank" href=".//index.html" rel="noopener">
          <img class="Footer-googleLogoImg" src="/images/google-white.png" alt="Google logo"/>
        </a>
      </div>
    </div>
  </div>
  <script src="/js/jquery.js"></script>
  <script src="/js/carousels.js"></script>
  <script src="/js/searchBox.js"></script>
  <script src="/js/misc.js"></script>
  <script src="/js/hats.js"></script>
  <script src="/js/playground.js"></script>
  <script src="/js/godocs.js"></script>
</footer>
















</body></html>